{"version":3,"sources":["../../src/plugin/index.ts"],"sourcesContent":["import type { Config } from 'payload'\nimport type { CustomLink, CustomGroup } from '../types'\n\n/**\n * Serializable custom link (icon as string key)\n */\nexport interface SerializableCustomLink {\n  label: string\n  href: string\n  group?: string\n  icon?: string // Icon key instead of component\n  external?: boolean\n  pinnable?: boolean\n  order?: number\n}\n\n/**\n * Plugin options for Payload Sidebar\n */\nexport interface PayloadSidebarPluginOptions {\n  /**\n   * Custom group order - map of group name to priority (lower = higher)\n   */\n  groupOrder?: Record<string, number>\n\n  /**\n   * Custom icons for collections/globals by slug\n   * Use Lucide icon names (kebab-case): 'shield-check', 'file-text', etc.\n   * Full list: https://lucide.dev/icons\n   *\n   * @example\n   * ```ts\n   * icons: {\n   *   users: 'users',\n   *   posts: 'file-text',\n   *   media: 'image',\n   *   'my-collection': 'shield-check',\n   * }\n   * ```\n   */\n  icons?: Record<string, string>\n\n  /**\n   * Custom navigation links\n   * Add your own links to the sidebar navigation\n   * @example\n   * ```ts\n   * customLinks: [\n   *   { label: 'Analytics', href: '/admin/analytics', group: 'Tools', icon: 'chart' },\n   *   { label: 'API Docs', href: 'https://api.example.com/docs', external: true },\n   * ]\n   * ```\n   */\n  customLinks?: CustomLink[]\n\n  /**\n   * Custom navigation groups\n   * Define additional groups or configure existing ones\n   * @example\n   * ```ts\n   * customGroups: [\n   *   { label: 'Tools', order: 5 },\n   *   { label: 'External', order: 99, defaultOpen: false },\n   * ]\n   * ```\n   */\n  customGroups?: CustomGroup[]\n\n  /**\n   * Enable pinning functionality\n   * @default true\n   */\n  enablePinning?: boolean\n  /**\n   * Storage for pinned items: 'preferences' (server) or 'localStorage' (client)\n   * @default 'preferences'\n   */\n  pinnedStorage?: 'preferences' | 'localStorage'\n  /**\n   * CSS class prefix\n   * @default 'nav'\n   */\n  classPrefix?: string\n  /**\n   * Custom CSS variables for badge colors\n   */\n  cssVariables?: Record<string, string>\n}\n\n/**\n * Serializable version of plugin options (stored in config.custom)\n */\nexport interface SerializablePluginOptions {\n  groupOrder?: Record<string, number>\n  icons?: Record<string, string>\n  customLinks?: SerializableCustomLink[]\n  customGroups?: CustomGroup[]\n  enablePinning?: boolean\n  pinnedStorage?: 'preferences' | 'localStorage'\n  classPrefix?: string\n  cssVariables?: Record<string, string>\n}\n\n/**\n * Config key for storing plugin options\n */\nexport const PLUGIN_OPTIONS_KEY = 'payloadSidebarOptions'\n\n/**\n * Get the current plugin options from Payload config\n */\nexport const getPluginOptions = (config: Config): SerializablePluginOptions => {\n  return (config.custom?.[PLUGIN_OPTIONS_KEY] as SerializablePluginOptions) || {}\n}\n\n/**\n * Serialize CustomLink to SerializableCustomLink\n * Converts icon components to string keys\n */\nfunction serializeCustomLink(link: CustomLink): SerializableCustomLink {\n  let iconKey: string | undefined\n\n  if (link.icon) {\n    // If icon is a component, try to get its displayName or name\n    if (typeof link.icon === 'function') {\n      iconKey = (link.icon as { displayName?: string }).displayName || link.icon.name || 'custom'\n    } else {\n      iconKey = String(link.icon)\n    }\n  }\n\n  return {\n    label: link.label,\n    href: link.href,\n    group: link.group,\n    icon: iconKey,\n    external: link.external,\n    pinnable: link.pinnable,\n    order: link.order,\n  }\n}\n\n/**\n * Payload Sidebar Plugin\n *\n * A customizable navigation sidebar for Payload CMS 3.x with:\n * - Sortable navigation groups\n * - Custom icons for collections/globals\n * - Pin items to top\n * - Multi-color badge support\n *\n * @example\n * ```ts\n * import { payloadSidebar } from 'payload-sidebar-plugin'\n *\n * export default buildConfig({\n *   plugins: [\n *     payloadSidebar({\n *       groupOrder: {\n *         'Content': 1,\n *         'Users': 2,\n *         'Settings': 3,\n *       },\n *       enablePinning: true,\n *     }),\n *   ],\n * })\n * ```\n */\nexport const payloadSidebar = (options: PayloadSidebarPluginOptions = {}) => {\n  return (incomingConfig: Config): Config => {\n    const config = { ...incomingConfig }\n\n    // Ensure admin config exists\n    config.admin = config.admin || {}\n    config.admin.components = config.admin.components || {}\n\n    // Set custom Nav component using the bundled RSC export\n    config.admin.components.Nav = 'payload-sidebar-plugin/rsc#CustomNav'\n\n    // Serialize options and store in config.custom\n    // This allows RSC to access options via payload.config\n    const serializableOptions: SerializablePluginOptions = {\n      groupOrder: options.groupOrder,\n      icons: options.icons,\n      customLinks: options.customLinks?.map(serializeCustomLink),\n      customGroups: options.customGroups,\n      enablePinning: options.enablePinning,\n      pinnedStorage: options.pinnedStorage,\n      classPrefix: options.classPrefix,\n      cssVariables: options.cssVariables,\n    }\n\n    config.custom = config.custom || {}\n    config.custom[PLUGIN_OPTIONS_KEY] = serializableOptions\n\n    return config\n  }\n}\n\nexport default payloadSidebar\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0GO,IAAM,qBAAqB;AAK3B,IAAM,mBAAmB,wBAAC,WAA8C;AAC7E,SAAQ,OAAO,SAAS,kBAAkB,KAAmC,CAAC;AAChF,GAFgC;AAQhC,SAAS,oBAAoB,MAA0C;AACrE,MAAI;AAEJ,MAAI,KAAK,MAAM;AAEb,QAAI,OAAO,KAAK,SAAS,YAAY;AACnC,gBAAW,KAAK,KAAkC,eAAe,KAAK,KAAK,QAAQ;AAAA,IACrF,OAAO;AACL,gBAAU,OAAO,KAAK,IAAI;AAAA,IAC5B;AAAA,EACF;AAEA,SAAO;AAAA,IACL,OAAO,KAAK;AAAA,IACZ,MAAM,KAAK;AAAA,IACX,OAAO,KAAK;AAAA,IACZ,MAAM;AAAA,IACN,UAAU,KAAK;AAAA,IACf,UAAU,KAAK;AAAA,IACf,OAAO,KAAK;AAAA,EACd;AACF;AArBS;AAkDF,IAAM,iBAAiB,wBAAC,UAAuC,CAAC,MAAM;AAC3E,SAAO,CAAC,mBAAmC;AACzC,UAAM,SAAS,EAAE,GAAG,eAAe;AAGnC,WAAO,QAAQ,OAAO,SAAS,CAAC;AAChC,WAAO,MAAM,aAAa,OAAO,MAAM,cAAc,CAAC;AAGtD,WAAO,MAAM,WAAW,MAAM;AAI9B,UAAM,sBAAiD;AAAA,MACrD,YAAY,QAAQ;AAAA,MACpB,OAAO,QAAQ;AAAA,MACf,aAAa,QAAQ,aAAa,IAAI,mBAAmB;AAAA,MACzD,cAAc,QAAQ;AAAA,MACtB,eAAe,QAAQ;AAAA,MACvB,eAAe,QAAQ;AAAA,MACvB,aAAa,QAAQ;AAAA,MACrB,cAAc,QAAQ;AAAA,IACxB;AAEA,WAAO,SAAS,OAAO,UAAU,CAAC;AAClC,WAAO,OAAO,kBAAkB,IAAI;AAEpC,WAAO;AAAA,EACT;AACF,GA7B8B;AA+B9B,IAAO,iBAAQ;","names":[]}